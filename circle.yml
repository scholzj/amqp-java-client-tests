machine:
  hosts:
    amqp-host: 127.0.0.1
  java:
    version: oraclejdk8
  services:
    - docker
  environment:
    #- MAVEN_TEST_SUITE=no-tests.xml BROKER_DOCKER_IMAGE=scholzj/java-client-tests:0.34
    MAVEN_TEST_SUITE: qpid-0.34.xml
    # MAVEN_TEST_SUITE: mrg-3.2.0.xml
    BROKER_DOCKER_IMAGE: scholzj/java-client-tests:0.34
    #- MAVEN_TEST_SUITE=qpid-0.36.xml BROKER_DOCKER_IMAGE=scholzj/java-client-tests:0.36
    #- MAVEN_TEST_SUITE=mrg-3.0.0.xml BROKER_DOCKER_IMAGE=scholzj/java-client-tests:3.0.0
    #- MAVEN_TEST_SUITE=mrg-3.2.0.xml BROKER_DOCKER_IMAGE=scholzj/java-client-tests:3.2.0

dependencies:
  pre:
    - unzip jce_policy-8.zip
    - sudo cp UnlimitedJCEPolicyJDK8/local_policy.jar ${JAVA_HOME}/jre/lib/security
    - sudo cp UnlimitedJCEPolicyJDK8/US_export_policy.jar ${JAVA_HOME}/jre/lib/security
    - mvn install -DskipTests=true
    
test:
  pre:
    - docker run -d -p 35672:5672 -p 35671:5671 $BROKER_DOCKER_IMAGE
  override:
    - mvn -fae test -Dsurefire.suiteXmlFiles=$(pwd)/$MAVEN_TEST_SUITE
  
